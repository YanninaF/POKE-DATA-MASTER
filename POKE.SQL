-- TABLA DE POKEMON
CREATE TABLE pokemones (
    id_pokemon SERIAL PRIMARY KEY,
    poke_nombre VARCHAR(100) UNIQUE NOT NULL,
    tipo VARCHAR(50) NOT NULL,
    habilidad VARCHAR(100) NOT NULL,
    ataque INTEGER,
    defensa INTEGER,
    nivel INT CHECK (nivel >= 1 AND nivel <= 100),
    salud INT CHECK (salud > 0)
);

--INSERTAR DATOS A LA TABLA POKEMON
INSERT INTO POKEMONES VALUES(1,'PIKACHU','RATON/ELECTRICO','ATACTRUENO',80,60,20,80);
INSERT INTO POKEMONES VALUES(2,'CHARMANDER','LAGARTO-BIPEDO','LANZALLAMAS',70,50,20,82);
INSERT INTO POKEMONES VALUES(3,'STARMIE','DOS-ESTRELLAS-5PUNTAS-AGUA','GOLPE CON INTENSIDAD AL GIRAR',60,50,18,79);
INSERT INTO POKEMONES VALUES(4,'ONIX','ROCA Y TIERRA','APLASTAR',65,83,15,80);
INSERT INTO POKEMONES VALUES(5,'GEODUDE','ROCAS','APLASTAR',65,83,15,80);
INSERT INTO POKEMONES VALUES(6,'RAICHU','ELECTRICO-PSIQUICO','ATACTRUENO-MEJORADO',60,80,10,85);


-- VER INFORMACION DE LA TABLA
SELECT * FROM POKEMONES ORDER BY ID_POKEMON
--VER INFORMACION DE UN POKEMON ESPECIFICO
select * from POKEMONES where id_pokemon= 1;

--ACTUALIZAR DATOS DE UN POKEMON
UPDATE POKEMONES 
SET poke_nombre = 'PIKACHU'--ACA YA SE PONE EL CAMBIO QUE SE QUIERE HACER
where poke_nombre = 'RAICHU'; -- Y ACA SE REFERENCIA COMO ESTABA NADA MAS 

-- ACTUALIZAR LA INFORMACION DE UN POKEMON / NOMBRE Y TIPO. 2 DATOS ACTUALIZADOS DE 2(COLUMNAS) ATRIBUTOS DIFERENTES
UPDATE pokemones
SET poke_nombre = 'PIKACHU', tipo = 'RATON/ELECTRICO'
WHERE id_pokemon = 1;

--MODIFICAMOS EL NOMBRE DE UNA COLUMNA
ALTER TABLE pokemones
RENAME COLUMN nombre TO poke_nombre; 



-- TABLA DE ENTRENADORES
CREATE TABLE entrenadores (
    id_entrenador SERIAL PRIMARY KEY,
    entre_nombre VARCHAR(100) UNIQUE NOT NULL,
    ciudad VARCHAR(100) NOT NULL,
    experiencia INTEGER CHECK (experiencia >= 0)
);

--INSERTAR DATOS A LA TABLA ENTRENADORES
INSERT INTO ENTRENADORES values(1,'ASCH', 'CIUDAD PALETA',16)
INSERT INTO ENTRENADORES values(2,'MISTY', 'CIUDAD CELESTE',10)
INSERT INTO ENTRENADORES values(3,'BROCK', 'CIUDAD PLATEADA',8)
INSERT INTO ENTRENADORES values(4,'SARGE', 'CIUDAD CARMIN',15)

--VER DATOS DE LA TABLA ENTRENADORES
SELECT * FROM ENTRENADORES ORDER BY id_entrenador
--VER DATOS DE LA TABLA ENTRENADORES DE UNO ESPECIFICO
select * from ENTRENADORES where ID_ENTRENADOR= 1;

-- ACTUALIZAR LA INFORMACION DE UN ENTRENADOR
UPDATE ENTRENADORES
SET ciudad = 'CIUDAD PALETA', experiencia = 16
WHERE id_entrenador = 1;


--TABLA INTERMEDIARIA ENTRENADORES_POKEMON

CREATE TABLE entrenadores_pokemones ( 
    id_entrenador INT ,
    id_pokemon INT UNIQUE ,
    PRIMARY KEY (id_entrenador, id_pokemon),
    FOREIGN KEY(id_entrenador) REFERENCES entrenadores(id_entrenador) ON DELETE CASCADE,
    FOREIGN KEY(id_pokemon) REFERENCES pokemones(id_pokemon) ON DELETE CASCADE --UN POKEMON PUEDE SER ASOCIADO A UN ENTRENADOR
);
--INSERCCION DE DATOS EN LA TABLA ENTRENADORES_POKEMONES
INSERT INTO entrenadores_pokemones VALUES (1,1 ); --ASCH TIENE A PIKACHU
INSERT INTO entrenadores_pokemones VALUES (1,2 ); --ASCH TIENE A CHARMANDER
INSERT INTO entrenadores_pokemones VALUES (2,3 ); --MISTY TIENE A STARMIE
INSERT INTO entrenadores_pokemones VALUES (3,4 ); --BROCK TIENE A ONIX
INSERT INTO entrenadores_pokemones VALUES (3,5 ); --BROCK TIENE A GEODUDE
INSERT INTO entrenadores_pokemones VALUES (4,6 ); --SARGE TIENE A RAICHU

--VER INFORMACION DE LA TABLA ENTRENADORES_POKEMONES
 SELECT * FROM ENTRENADORES_POKEMONES


-- TABLA BATALLAS
CREATE TABLE batallas (
    id_batalla SERIAL PRIMARY KEY,
    fecha DATE NOT NULL,
    lugar VARCHAR(100) NOT NULL
);


--VER INFORMACION DE LA TABLA BATALLA
SELECT * FROM BATALLAS ORDER BY ID_BATALLA;


--VER INFORMACION DE LA TABLA BATALLA DE UNO ESPECIFICO
SELECT * FROM BATALLAS WHERE ID_BATALLA=1;


--INSERCION DE DATOS DE LA TABLA BATALLAS
INSERT INTO BATALLAS VALUES (1,'23-07-2024','GIMNASCIO CELESTE')
INSERT INTO BATALLAS VALUES (2,'23-07-2024','GIMNASIO PLATEADO')
INSERT INTO BATALLAS VALUES (3,'23-07-2024','GIMNASIO PALETA')
INSERT INTO BATALLAS VALUES (4,'25-07-2024','GIMNASIO CARMIN')

-- ACTUALIZAR LA INFORMACION DE UNA BATALLA
UPDATE BATALLAS
SET lugar = 'GIMNASIO CELESTE'
WHERE lugar ='GIMNASCIO CELESTE';


-- TABLA DE PARTICIPANTES_BATALLAS---no anda
CREATE TABLE participantes_batallas(
id_batalla INT REFERENCES batallas(id_batalla) ON DELETE CASCADE,
id_entrenador INT,
id_pokemon INT,
resultado VARCHAR(50)NOT NULL,
PRIMARY KEY (id_entrenador,id_pokemon),
FOREIGN KEY(id_entrenador,id_pokemon) REFERENCES entrenadores_pokemones(id_entrenador, id_pokemon) ON DELETE CASCADE

);

CREATE TABLE participantes_batallas(--si anda
    id_batalla INT REFERENCES batallas(id_batalla) ON DELETE CASCADE,
    id_entrenador INT,
    id_pokemon INT,
    resultado VARCHAR(50) NOT NULL,
    PRIMARY KEY (id_batalla, id_entrenador, id_pokemon),
    FOREIGN KEY (id_entrenador, id_pokemon) REFERENCES entrenadores_pokemones(id_entrenador, id_pokemon) ON DELETE CASCADE
);





--VER INFORMACION DE LA TABLA PARTICIPANTES_BATALLAS
SELECT * FROM PARTICIPANTES_BATALLAS

--INSERCCION DE PARTICIPANTES BATALLAS
INSERT INTO PARTICIPANTES_BATALLAS VALUES( 1,1,1,'EMPATE');
INSERT INTO PARTICIPANTES_BATALLAS VALUES( 1,2,3,'EMPATE');
INSERT INTO PARTICIPANTES_BATALLAS VALUES( 4,1,1,'EMPATE');
INSERT INTO PARTICIPANTES_BATALLAS VALUES( 4,4,6,'EMPATE');


--para PROBAR CON MI EVALUADOR
INSERT INTO PARTICIPANTES_BATALLAS VALUES( 2,3,4,'DERROTA');
INSERT INTO PARTICIPANTES_BATALLAS VALUES( 2,1,2,'VICTORIA');


--ELIMINAR REGISTRO DE ENTRENADOR EN FORMA CASCADE

/*/  DATO IMPORTANTE RESPECTO A UTLIZAR EL "ON DELETE CASCADE"
SIMPLIFICA LA OPERACION ELIMINAR.NO TIENES QUE VOLVER A HACER
CONSULTAS ADICIONALES PARA ELIMINAR MANUALMENTE LAS FILAS DEPENDIENTES
SI ELIMINAS UN ENTRENADOR AUTOMATICO ELIMINA:
Entrenadores_Pokémon y Participantes_Batallas
/*/

DELETE FROM ENTRENADORES WHERE id_entrenador = 4;


/*/Consultas Multi-Table
COMBINACION DE DATOS DE MULTIPLES TABLAS /*/

 -- Mostrar información detallada sobre las batallas el  Pokémon y sus entrenadores
SELECT 
    b.id_batalla as id_batalla,
    b.fecha as fecha_batalla,
    b.lugar as lugar,
    e.id_entrenador as id_entrenador,
    e.entre_nombre as nombre_entrenador,
    p.id_pokemon as id_pokemon,
    p.poke_nombre as nombre_pokemon,
    pb.resultado  as resultado_participantes
    
FROM batallas b
JOIN participantes_batallas pb ON b.id_batalla = pb.id_batalla
JOIN entrenadores e ON pb.id_entrenador = e.id_entrenador
JOIN pokemones p ON pb.id_pokemon = p.id_pokemon
ORDER BY b.fecha, b.id_batalla;

--MOSTRAR INFORMACION SOBRE LOS POKEMONES Y ENTRENADORES

SELECT 
    e.id_entrenador,
    e.entre_nombre,
    e.ciudad,
    e.experiencia,
    p.id_pokemon,
    p.poke_nombre,
    p.tipo,
    p.habilidad,
    p.ataque,
    p.defensa,
    p.nivel,
    p.salud

FROM  entrenadores e
JOIN entrenadores_pokemones ep ON e.id_entrenador = ep.id_entrenador
JOIN pokemones p ON ep.id_pokemon = p.id_pokemon;








